#!/usr/bin/env bash
# Get listening ports with corresponding PIDs
listening_ports=$(netstat -tuln | awk '/^tcp/ || /^udp/ {print $1, $4, $7}')

# Print header
echo "Active Internet connections (only servers)"
echo "Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name"

# Loop through listening ports
while IFS=' ' read -r proto local_address pid_program; do
    # Split PID and program name
    pid=$(echo "$pid_program" | cut -d'/' -f1)
    program_name=$(echo "$pid_program" | cut -d'/' -f2)

    # Check if PID is not available
    if [[ -z "$pid" ]]; then
        pid="-"
        program_name="-"
    else
        # Get program name corresponding to PID
        program_name=$(ps -p "$pid" -o comm= 2>/dev/null)
    fi

    # Print information
    echo "$proto        -       -       $local_address                 LISTEN      $pid/$program_name"
done <<< "$listening_ports"

